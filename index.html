<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS App Access Automation</title>
    <style>
        body {
            margin: 0 20px;
            padding: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        ul {
            margin: 0;
            padding-left: 20px;
        }
        .responsive-image {
            max-width: 100%;
            max-height: 100vh;
            width: auto;
            height: auto;
            display: block
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>iOS App Access Automation</h1>

    <h2>Background</h2>
    <p>
        Apple restricts devices from installing and using apps from outside its official app market, App Store, without establishing a form of trust between the device and the app’s developer through the Apple Developer Program. Firebase simplifies this process.
    </p>
    <p>
        However, even with Firebase, allowing users to download an iOS app from Firebase is still a very complicated process. When a user registers their device with Firebase to request access to the app, it can take up to 24 hours for developers to complete the necessary work to allow the users to download the app, especially when there’s a timezone difference.
    </p>
    <p>
        This project aims to solve this problem by automating the work required on the developer’s side to grant access to the app after a user registers their device with Firebase.
    </p>

    <h2>How It Works for Users</h2>
    <p>
        Once this project is functional, users will only need to wait approximately 1 hour after registering their device with Firebase, after which they will receive an email from Firebase that informs the build is ready to be downloaded and installed.
    </p>
    <h2>Project Timeline</h2>
    <ul>
        <li><strong>Start Date:</strong> 16 Dec 2024</li>
        <li><strong>Expected Completion Date:</strong> 24 Jan 2025</li>
        <li><strong>Working Hours a Week:</strong> 10 hours</li>
    </ul>
    <h2>Design</h2>
    <img src="images/diagram.jpg" alt="Design" class="responsive-image">
    <h2>Task Breakdown</h2>
    <table>
    <thead>
        <tr>
            <th>No.</th>
            <th>Task</th>
            <th>Component</th>
            <th>Hours</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Distribution Certificate in Github Actions
                <ul>
                    <li>Export the Certificate from Xcode</li>
                    <li>Base64-encode the certificate and save it in GitHub Secrets</li>
                    <li>Create KeyChain in a GitHub workflow</li>
                    <li>Install the certificate in GitHub workflow</li>
                </ul>
            </td>
            <td>iOS build GitHub workflow</td>
            <td>4</td>
            <td>Done</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Provisioning Profile in Github Actions
                <ul>
                    <li>Create a Private Key to access Apple Connect API</li>
                    <li>A Python script to download the Provisioning Profile</li>
                    <li>Copy the downloaded Provisioning Profile to workplace folder</li>
                </ul>
            </td>
            <td>iOS build GitHub workflow</td>
            <td>4</td>
            <td>Done</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Build the iOS app using Github Actions
                <ul>
                    <li>Learn the basic usage of xcodebuild</li>
                    <li>Create archive</li>
                    <li>Export IPA</li>

                </ul>
            </td>
            <td>iOS build GitHub workflow</td>
            <td>8</td>
            <td>Done</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Listen to new device registration in Firebase using Firebase Cloud Functions
<ul>
                    <li>Setup Firebase Cloud Functions project</li>
                    <li>Add event listener for new device registration</li>
                    <li>Add logs</li>

                </ul>
</td>
                
            <td>iOSAppInviteAlert</td>
            <td>4</td>
            <td>Done</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Register new Apple device UUIDs using Apple Connect API through Firebase Cloud Functions</td>
            <td>iOSAppInviteAlert</td>
            <td>4</td>
            <td>In Progress</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Update the Provisioning Profile using Apple Connect API through Firebase Cloud Functions
            <ul>
                    <li>Re-use the setup from No.5 for calling Apple Connect API</li>
                </ul>
            </td>
            <td>iOSAppInviteAlert</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Use RSA to support secure communications between Firebase Cloud Functions and iOSAppAccessAutomation backend app</td>
            <td>iOSAppInviteAlert</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Write an API for Firebase Cloud Functions to send emails and UUIDs
            <ul>
                    <li>Setup PostgreSQL in Heroku</li>
                </ul>
            </td>
            <td>iOSAppAccessAutomation</td>
            <td>4</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Send the email and the UUID of the new device to iOSAppAccessAutomation backend app through Firebase Cloud Functions</td>
            <td>iOSAppInviteAlert</td>
            <td>4</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>10</td>
            <td>Trigger iOS build process in Github Actions through Firebase Cloud Functions
            <ul>
                    <li>Learn how to use GitHub Actions' Rest APIs for this</li>
                </ul>
            </td>
            <td>iOSAppInviteAlert</td>
            <td>8</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Use RSA to support secure communications between the GitHub workflow and iOSAppAccessAutomation backend app</td>
            <td>iOS build GitHub workflow</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
                <tr>
            <td>12</td>
            <td>Write an API for the GitHub workflow to download the list of emails</td>
            <td>iOSAppAccessAutomation</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Download the list of emails from iOSAppAccessAutomation</td>
            <td>iOS build GitHub workflow</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Distribute the app through Firebase App Distribution</td>
            <td>iOS build GitHub workflow</td>
            <td>2</td>
            <td>Not Started Yet</td>
        </tr>
        <tr>
            <td></td>
            <td><strong>Total</strong></td>
            <td></td>
            <td><strong>52</strong></td>
            <td></td>
        </tr>
    </tbody>
</table>




    <h2>Github</h2>
    <a href="https://github.com/AungThiha/iOSAppAccessAutomation">https://github.com/AungThiha/iOSAppAccessAutomation</a>

    <h2>Resources</h2>
    <ul>
        <li>
            Firebase allows developers to subscribe to device list changes programmatically, including new device registration. 
            <a href="https://firebase.google.com/docs/app-distribution/register-additional-devices" target="_blank">https://firebase.google.com/docs/app-distribution/register-additional-devices</a>
        </li>
        <li>
            Apple offers an API that allows developers to programmatically add a new device in their Apple Developer Account. 
            <a href="https://developer.apple.com/documentation/appstoreconnectapi/post-v1-devices" target="_blank">https://developer.apple.com/documentation/appstoreconnectapi/post-v1-devices</a>
        </li>
        <li>
            Apple offers an API to download provisioning profiles programmatically. 
            <a href="https://developer.apple.com/documentation/appstoreconnectapi/get-v1-profiles" target="_blank">https://developer.apple.com/documentation/appstoreconnectapi/get-v1-profiles</a>
        </li>
        <li>
            Apple allows building a release iOS build from a command line. 
            <a href="https://developer.apple.com/library/archive/technotes/tn2339/_index.html#//apple_ref/doc/uid/DTS40014588-CH1-HOW_DO_I_BUILD_MY_PROJECTS_FROM_THE_COMMAND_LINE_" target="_blank">https://developer.apple.com/library/archive/technotes/tn2339/_index.html#//apple_ref/doc/uid/DTS40014588-CH1-HOW_DO_I_BUILD_MY_PROJECTS_FROM_THE_COMMAND_LINE_</a>
        </li>
        <li>
            Firebase offers an API to upload an iOS build from a command line. 
            <a href="https://firebase.google.com/docs/app-distribution/ios/distribute-cli" target="_blank">https://firebase.google.com/docs/app-distribution/ios/distribute-cli</a>
        </li>
    </ul>
    <h2>Author</h2>
    Aung Thiha
</body>
</html>
